<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Hadoop多目录输出"><meta name="keywords" content="Hadoop"><meta name="author" content="Tunan"><meta name="copyright" content="Tunan"><title>Hadoop多目录输出 | TUNANのBlog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#目录"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MultipleOutputFormat"><span class="toc-number">2.</span> <span class="toc-text">MultipleOutputFormat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MultipleOutputs"><span class="toc-number">3.</span> <span class="toc-text">MultipleOutputs</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/xiaoqi.jpg"></div><div class="author-info__name text-center">Tunan</div><div class="author-info__description text-center">BigData Developer</div><div class="follow-button"><a href="#">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">239</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">39</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">35</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://hadoop.apache.org/docs/r2.10.0/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="noopener">HADOOP</a><a class="author-info-links__name text-center" href="https://cwiki.apache.org/confluence/display/Hive/" target="_blank" rel="noopener">HIVE</a><a class="author-info-links__name text-center" href="http://archive.cloudera.com/cdh5/cdh/5/" target="_blank" rel="noopener">CDH</a><a class="author-info-links__name text-center" href="http://flume.apache.org/" target="_blank" rel="noopener">FLUME</a><a class="author-info-links__name text-center" href="https://azkaban.github.io/" target="_blank" rel="noopener">AZKABAN</a><a class="author-info-links__name text-center" href="https://www.maxinhong.com/" target="_blank" rel="noopener">叶梨子</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/qingyunzong" target="_blank" rel="noopener">老铁</a><a class="author-info-links__name text-center" href="https://blog.csdn.net/jim8973/" target="_blank" rel="noopener">飞哥</a><a class="author-info-links__name text-center" href="https://vinxikk.github.io/" target="_blank" rel="noopener">vinx</a><a class="author-info-links__name text-center" href="http://dongxicheng.org/" target="_blank" rel="noopener">懂西成(Hadoop技术内幕作者)</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/xing901022/" target="_blank" rel="noopener">xingoo</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/itboys/tag/" target="_blank" rel="noopener">大葱拌豆腐</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/shishanyuan" target="_blank" rel="noopener">郭景瞻(图解Spark作者)</a><a class="author-info-links__name text-center" href="https://segmentfault.com/u/wishdaren_5c243b920a3eb" target="_blank" rel="noopener">Wish大人</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/huxi2b/" target="_blank" rel="noopener">huxi_2b(kafka)</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/soroush-golpoor-1497416-unsplash.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">TUNANのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">Hadoop多目录输出</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-11-25</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Hadoop/">Hadoop</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">3.3k</span><span class="post-meta__separator">|</span><span>Reading time: 15 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li>MultipleOutputFormat</li>
<li>MultipleOutputs</li>
</ol>
<h2 id="MultipleOutputFormat"><a href="#MultipleOutputFormat" class="headerlink" title="MultipleOutputFormat"></a>MultipleOutputFormat</h2><p>直到目前，我们看到的所有Mapreduce作业都输出一组文件。但是，在一些场合下，经常要求我们将输出多组文件或者把一个数据集分为多个数据集更为方便；比如将一个log里面属于不同业务线的日志分开来输出，并交给相关的业务线。</p>
<p>用过旧API的人应该知道，旧API中有 org.apache.hadoop.mapred.lib.MultipleOutputFormat和org.apache.hadoop.mapred.lib.MultipleOutputs，文档对MultipleOutputFormat的解释（MultipleOutputs 解释在后面）是：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MultipleOutputFormat allowing to write the output data to different output files.</span><br></pre></td></tr></table></figure>

<p>MultipleOutputFormat可以将相似的记录输出到相同的数据集。在写每条记录之前，MultipleOutputFormat将调用generateFileNameForKeyValue方法来确定需要写入的文件名。通常，我们都是继MultipleTextOutputFormat类，来重新实现generateFileNameForKeyValue方法以返回每个输出键/值对的文件名。generateFileNameForKeyValue方法的默认实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">generateFileNameForKeyValue</span><span class="params">(K key, V value, String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回默认的name，我们可以在自己的类中重写这个方法，来定义自己的输出路径，比如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PartitionFormat</span></span></span><br><span class="line"><span class="class">            <span class="keyword">extends</span> <span class="title">MultipleTextOutputFormat</span>&lt;<span class="title">NullWritable</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> String <span class="title">generateFileNameForKeyValue</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                NullWritable key,</span></span></span><br><span class="line"><span class="function"><span class="params">                Text value, </span></span></span><br><span class="line"><span class="function"><span class="params">                String name)</span> </span>&#123;</span><br><span class="line">            String[] split = value.toString().split(<span class="string">","</span>, -<span class="number">1</span>);</span><br><span class="line">            String country = split[<span class="number">4</span>].substring(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">return</span> country + <span class="string">"/"</span> + name;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样相同country的记录将会输出到同一目录下的name文件中。完整的例子如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyp;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.lib.MultipleTextOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutputTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MapClass</span> <span class="keyword">extends</span> <span class="title">MapReduceBase</span> </span></span><br><span class="line"><span class="class">            <span class="keyword">implements</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, </span></span></span><br><span class="line"><span class="function"><span class="params">                        OutputCollector&lt;NullWritable, Text&gt; output, </span></span></span><br><span class="line"><span class="function"><span class="params">                        Reporter reporter)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            output.collect(NullWritable.get(), value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PartitionFormat</span> </span></span><br><span class="line"><span class="class">            <span class="keyword">extends</span> <span class="title">MultipleTextOutputFormat</span>&lt;<span class="title">NullWritable</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">//和上面一样，就不写了</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        JobConf job = <span class="keyword">new</span> JobConf(conf, OutputTest<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        String[] remainingArgs = </span><br><span class="line">                <span class="keyword">new</span> GenericOptionsParser(conf, args).getRemainingArgs();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (remainingArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Error!"</span>);</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        Path in = <span class="keyword">new</span> Path(remainingArgs[<span class="number">0</span>]);</span><br><span class="line">        Path out = <span class="keyword">new</span> Path(remainingArgs[<span class="number">1</span>]);</span><br><span class="line"> </span><br><span class="line">        FileInputFormat.setInputPaths(job, in);</span><br><span class="line">        FileOutputFormat.setOutputPath(job, out);</span><br><span class="line"> </span><br><span class="line">        job.setJobName(<span class="string">"Output"</span>);</span><br><span class="line">        job.setMapperClass(MapClass<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">        job.setInputFormat(TextInputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputFormat(PartitionFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">        job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line">        JobClient.runJob(job);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将上面的程序打包成jar文件（具体怎么打包，就不说），并在<a href="https://www.iteblog.com/archives/tag/hadoop/" target="_blank" rel="noopener">Hadoop</a>2.2.0上面运行（测试数据请在这里下载：<a href="http://pan.baidu.com/s/1td8xN）：" target="_blank" rel="noopener">http://pan.baidu.com/s/1td8xN）：</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">/home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop jar                      \</span><br><span class="line">      /export1/tmp/wyp/OutputText.jar com.wyp.OutputTest \</span><br><span class="line">      /home/wyp/apat63_99.txt                            \ </span><br><span class="line">      /home/wyp/out</span><br></pre></td></tr></table></figure>

<p>运行完程序之后，可以去/home/wyp/out目录看下运行结果：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[wyp<span class="meta">@l</span>-datalog5.data.cn1 ~]$ /home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop fs         \</span><br><span class="line">                                     -ls /home/wyp/out</span><br><span class="line">.............................这里省略了很多...................................</span><br><span class="line">drwxr-xr-x   - wyp  supergroup     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/VE</span><br><span class="line">drwxr-xr-x   - wyp  supergroup     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/VG</span><br><span class="line">drwxr-xr-x   - wyp  supergroup     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/VN</span><br><span class="line">drwxr-xr-x   - wyp  supergroup     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/VU</span><br><span class="line">drwxr-xr-x   - wyp  supergroup     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/YE</span><br><span class="line">.............................这里省略了很多...................................</span><br><span class="line">-rw-r--r--   <span class="number">3</span> wyp  supergroup     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/_SUCCESS</span><br><span class="line"> </span><br><span class="line">[wyp<span class="meta">@l</span>-datalog5.data.cn1 ~]$ /home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop fs        \</span><br><span class="line">                                    -ls /home/wyp/out/VN</span><br><span class="line">Found <span class="number">2</span> items</span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp supergroup  <span class="number">148</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/VN/part-<span class="number">00000</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp supergroup  <span class="number">566</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">25</span> /home/wyp/out/VN/part-<span class="number">00001</span></span><br><span class="line"> </span><br><span class="line">[wyp<span class="meta">@l</span>-datalog5.data.cn1 ~]$ /home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop fs        \</span><br><span class="line">                                   -cat /home/wyp/out/VN/part-<span class="number">00001</span></span><br><span class="line"><span class="number">3430490</span>,<span class="number">1969</span>,<span class="number">3350</span>,<span class="number">1965</span>,<span class="string">"VN"</span>,<span class="string">""</span>,<span class="number">597185</span>,<span class="number">6</span>,,<span class="number">73</span>,<span class="number">4</span>,<span class="number">43</span>,,<span class="number">0</span>,,,,,,,,,</span><br><span class="line"><span class="number">3630470</span>,<span class="number">1971</span>,<span class="number">4379</span>,<span class="number">1970</span>,<span class="string">"VN"</span>,<span class="string">""</span>,,<span class="number">1</span>,,<span class="number">244</span>,<span class="number">5</span>,<span class="number">55</span>,,<span class="number">4</span>,,<span class="number">0.375</span>,,<span class="number">22.5</span>,,,,,</span><br><span class="line"><span class="number">3654325</span>,<span class="number">1972</span>,<span class="number">4477</span>,<span class="number">1969</span>,<span class="string">"VN"</span>,<span class="string">""</span>,,<span class="number">1</span>,,<span class="number">554</span>,<span class="number">1</span>,<span class="number">14</span>,,<span class="number">0</span>,,,,,,,,,</span><br><span class="line"><span class="number">3665081</span>,<span class="number">1972</span>,<span class="number">4526</span>,<span class="number">1970</span>,<span class="string">"VN"</span>,<span class="string">""</span>,,<span class="number">1</span>,,<span class="number">373</span>,<span class="number">6</span>,<span class="number">66</span>,,<span class="number">1</span>,,<span class="number">0</span>,,<span class="number">3</span>,,,,,</span><br><span class="line"><span class="number">3772710</span>,<span class="number">1973</span>,<span class="number">5072</span>,<span class="number">1972</span>,<span class="string">"VN"</span>,<span class="string">""</span>,,<span class="number">1</span>,,<span class="number">4</span>,<span class="number">6</span>,<span class="number">65</span>,,<span class="number">1</span>,,<span class="number">0</span>,,<span class="number">8</span>,,,,,</span><br><span class="line"><span class="number">3821853</span>,<span class="number">1974</span>,<span class="number">5296</span>,<span class="number">1971</span>,<span class="string">"VN"</span>,<span class="string">""</span>,,<span class="number">1</span>,,<span class="number">33</span>,<span class="number">6</span>,<span class="number">69</span>,,<span class="number">1</span>,,<span class="number">0</span>,,<span class="number">23</span>,,,,,</span><br><span class="line"><span class="number">3824277</span>,<span class="number">1974</span>,<span class="number">5310</span>,<span class="number">1970</span>,<span class="string">"VN"</span>,<span class="string">""</span>,<span class="number">347650</span>,<span class="number">3</span>,,<span class="number">562</span>,<span class="number">1</span>,<span class="number">14</span>,,<span class="number">2</span>,,<span class="number">0.5</span>,,<span class="number">9</span>,,,,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="number">3918104</span>,<span class="number">1975</span>,<span class="number">5793</span>,<span class="number">1972</span>,<span class="string">"VN"</span>,<span class="string">""</span>,,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">65</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0.4</span>,,<span class="number">0</span>,,<span class="number">18.2</span>,,,,</span><br></pre></td></tr></table></figure>

<p>从上面的结果可以看出，所有country相同的结果都输出到同一个文件夹下面了。MultipleOutputFormat对完全控制文件名和目录名很方便。大家也看到了上面的程序是基于行的split，如果我们要基于列的split，MultipleOutputFormat就无能为力了。这时MultipleOutputs就用上场了。MultipleOutputs在很早的版本就存在，那么我们先看看官方文档是怎么解释MultipleOutputs的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MultipleOutputs creates multiple OutputCollectors. Each OutputCollector can have its own OutputFormat and types <span class="keyword">for</span> the key/value pair. Your MapReduce program will decide what to output to each OutputCollector.</span><br></pre></td></tr></table></figure>



<h2 id="MultipleOutputs"><a href="#MultipleOutputs" class="headerlink" title="MultipleOutputs"></a>MultipleOutputs</h2><p>与MultipleOutputFormat类不一样的是，MultipleOutputs可以为不同的输出产生不同类型，到这里所说的MultipleOutputs类还是旧版本的功能，后面会提到新版本类库的强化版MultipleOutputs类，下面我们来用旧版本的MultipleOutputs类说明它是如何为不同的输出产生不同类型，MultipleOutputs类不是要求给每条记录请求文件名，而是创建多个OutputCollectors。每个OutputCollector可以有自己的OutputFormat和键值对类型，Mapreduce程序将决定如何向每个OutputCollector输出数据（看看上面的英文文档），说的你很晕吧，来看看代码吧！下面的代码将地理相关的信息存储在geo开头的文件中；而将时间相关的信息存储在chrono开头的文件中，具体的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyp;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.lib.MultipleOutputs;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * User: /</span></span><br><span class="line"><span class="comment"> * Date: 13-11-27</span></span><br><span class="line"><span class="comment"> * Time: 下午10:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OldMulOutput</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MapClass</span> </span></span><br><span class="line"><span class="class">            <span class="keyword">extends</span> <span class="title">MapReduceBase</span></span></span><br><span class="line"><span class="class">            <span class="keyword">implements</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, </span></span><br><span class="line"><span class="class">            <span class="title">Text</span>, <span class="title">NullWritable</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> MultipleOutputs mos;</span><br><span class="line">        <span class="keyword">private</span> OutputCollector&lt;NullWritable, Text&gt; collector;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(JobConf conf)</span> </span>&#123;</span><br><span class="line">            mos = <span class="keyword">new</span> MultipleOutputs(conf);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value,</span></span></span><br><span class="line"><span class="function"><span class="params">                        OutputCollector&lt;NullWritable, Text&gt; output,</span></span></span><br><span class="line"><span class="function"><span class="params">                        Reporter reporter)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            String[] arr = value.toString().split(<span class="string">","</span>, -<span class="number">1</span>);</span><br><span class="line">            String chrono = arr[<span class="number">1</span>] + <span class="string">","</span> + arr[<span class="number">2</span>];</span><br><span class="line">            String geo = arr[<span class="number">4</span>] + <span class="string">","</span> + arr[<span class="number">5</span>];</span><br><span class="line">            collector = mos.getCollector(<span class="string">"chrono"</span>, reporter);</span><br><span class="line">            collector.collect(NullWritable.get(), <span class="keyword">new</span> Text(chrono));</span><br><span class="line">            collector = mos.getCollector(<span class="string">"geo"</span>, reporter);</span><br><span class="line">            collector.collect(NullWritable.get(), <span class="keyword">new</span> Text(geo));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            mos.close();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">            String[] remainingArgs =</span><br><span class="line">             <span class="keyword">new</span> GenericOptionsParser(conf, args).getRemainingArgs();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (remainingArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">                System.err.println(<span class="string">"Error!"</span>);</span><br><span class="line">                System.exit(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            JobConf job = <span class="keyword">new</span> JobConf(conf, OldMulOutput<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            Path in = <span class="keyword">new</span> Path(remainingArgs[<span class="number">0</span>]);</span><br><span class="line">            Path out = <span class="keyword">new</span> Path(remainingArgs[<span class="number">1</span>]);</span><br><span class="line">            FileInputFormat.setInputPaths(job, in);</span><br><span class="line">            FileOutputFormat.setOutputPath(job, out);</span><br><span class="line"> </span><br><span class="line">            job.setJobName(<span class="string">"MultiFile"</span>);</span><br><span class="line">            job.setMapperClass(MapClass<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            job.setInputFormat(TextInputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            job.setOutputKeyClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            job.setOutputValueClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">            job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line">            MultipleOutputs.addNamedOutput(job,</span><br><span class="line">                    <span class="string">"chrono"</span>,</span><br><span class="line">                    TextOutputFormat<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">                    <span class="title">NullWritable</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">                    <span class="title">Text</span>.<span class="title">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">            MultipleOutputs.addNamedOutput(job,</span><br><span class="line">                    <span class="string">"geo"</span>,</span><br><span class="line">                    TextOutputFormat<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">                    <span class="title">NullWritable</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">                    <span class="title">Text</span>.<span class="title">class</span>)</span>;</span><br><span class="line">            JobClient.runJob(job);</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面程序来源《<a href="https://www.iteblog.com/archives/tag/hadoop/" target="_blank" rel="noopener">Hadoop</a> in action》。同样将上面的程序打包成jar文件（具体怎么打包，也不说了），并在<a href="https://www.iteblog.com/archives/tag/hadoop/" target="_blank" rel="noopener">Hadoop</a>2.2.0上面运行（测试数据请在这里下载：<a href="http://pan.baidu.com/s/1td8xN）：" target="_blank" rel="noopener">http://pan.baidu.com/s/1td8xN）：</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">/home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop jar                        \</span><br><span class="line">      /export1/tmp/wyp/OutputText.jar com.wyp.OldMulOutput \</span><br><span class="line">      /home/wyp/apat63_99.txt                              \ </span><br><span class="line">      /home/wyp/out5</span><br></pre></td></tr></table></figure>

<p>运行完程序之后，可以去/home/wyp/out5目录看下运行结果：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[wyp<span class="meta">@l</span>-datalogm1.data.cn1 bin]$ /home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop fs  \</span><br><span class="line">                                -ls /home/wyp/out5</span><br><span class="line">Found <span class="number">7</span> items</span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">57</span> /home/wyp/out5/_SUCCESS</span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg <span class="number">31243</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">15</span>:<span class="number">57</span> /home/wyp/out5/chrono-m-<span class="number">00000</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg <span class="number">22719</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">15</span>:<span class="number">57</span> /home/wyp/out5/chrono-m-<span class="number">00001</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg <span class="number">29922</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">15</span>:<span class="number">57</span> /home/wyp/out5/geo-m-<span class="number">00000</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg <span class="number">20429</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">15</span>:<span class="number">57</span> /home/wyp/out5/geo-m-<span class="number">00001</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">57</span> /home/wyp/out5/part-m-<span class="number">00000</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp sg     <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">14</span>:<span class="number">57</span> /home/wyp/out5/part-m-<span class="number">00001</span></span><br></pre></td></tr></table></figure>

<p>大家可以看到在输出的文件中还存在以part开头的文件，但是里面没有信息，这是程序默认的输出文件，输出的收集器的名称是不能为part的，这是因为它已经被使用为默认的值了。</p>
<p>从上面的程序可以看出，旧版本的MultipleOutputs可以将文件基于列来进行分割，但是如果你想进行基于行的分割，这就要求你自己去实现代码了，恨不方便，针对这个问题，新版本的MultipleOutputs已经将旧版本的MultipleOutputs和MultipleOutputFormat的功能合并了，也就是说新版本的MultipleOutputs类具有旧版本的MultipleOutputs功能和MultipleOutputFormat功能；同时，在新版本的类库中已经不存在MultipleOutputFormat类了，因为MultipleOutputs都有它的功能了，还要她干嘛呢？看看官方文档是怎么说的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">The MultipleOutputs <span class="class"><span class="keyword">class</span> <span class="title">simplifies</span> <span class="title">writing</span> <span class="title">output</span> <span class="title">data</span> <span class="title">to</span> <span class="title">multiple</span> <span class="title">outputs</span> </span></span><br><span class="line">Case one: writing to additional outputs other than the job default output. Each additional output, or named output, may be configured with its own OutputFormat, with its own key class and with its own value class. </span><br><span class="line">Case two: to write data to different files provided by user</span><br></pre></td></tr></table></figure>

<p>再看看下面摘自Hadoop：The.Definitive.Guide(3rd,Early.Release)P251，它是怎么说的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">In the old MapReduce API there are two classes <span class="keyword">for</span> producing multiple outputs: MultipleOutputFormat and MultipleOutputs. In a nutshell, MultipleOutputs is more fully featured, but MultipleOutputFormat has more control over the output directory structure and file naming. MultipleOutputs in the <span class="keyword">new</span> API combines the best features of the two multiple output classes in the old API.</span><br></pre></td></tr></table></figure>

<p>也就是说MultipleOutputs合并了旧版本的MultipleOutputs功能和MultipleOutputFormat功能，新api都是用mapreduce包。好了，刚刚也说了新版本的MultipleOutputs有了旧版本的MultipleOutputFormat功能，那么我该怎么在新版的MultipleOutputs中实现旧版本MultipleOutputFormat的多文件输出呢？也就是上面第一个程序。看看下面的代码吧。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyp;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.TextInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.LazyOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.MultipleOutputs;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.TextOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MulOutput</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MapClass</span> </span></span><br><span class="line"><span class="class">            <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> MultipleOutputs mos;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">(Context context)</span> </span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.setup(context);</span><br><span class="line">            mos = <span class="keyword">new</span> MultipleOutputs(context);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, </span></span></span><br><span class="line"><span class="function"><span class="params">                           Text value, </span></span></span><br><span class="line"><span class="function"><span class="params">                           Context context)</span> </span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            mos.write(NullWritable.get(), value, </span><br><span class="line">                    generateFileName(value));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">private</span> String <span class="title">generateFileName</span><span class="params">(Text value)</span> </span>&#123;</span><br><span class="line">            String[] split = value.toString().split(<span class="string">","</span>, -<span class="number">1</span>);</span><br><span class="line">            String country = split[<span class="number">4</span>].substring(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">return</span> country + <span class="string">"/"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">(Context context)</span> </span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.cleanup(context);</span><br><span class="line">            mos.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ClassNotFoundException, </span></span><br><span class="line"><span class="function">            InterruptedException </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"MulOutput"</span>);</span><br><span class="line">        String[] remainingArgs = </span><br><span class="line">                <span class="keyword">new</span> GenericOptionsParser(conf, args)</span><br><span class="line">                        .getRemainingArgs();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (remainingArgs.length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Error!"</span>);</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Path in = <span class="keyword">new</span> Path(remainingArgs[<span class="number">0</span>]);</span><br><span class="line">        Path out = <span class="keyword">new</span> Path(remainingArgs[<span class="number">1</span>]);</span><br><span class="line"> </span><br><span class="line">        FileInputFormat.setInputPaths(job, in);</span><br><span class="line">        FileOutputFormat.setOutputPath(job, out);</span><br><span class="line"> </span><br><span class="line">        job.setJarByClass(MulOutput<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapperClass(MapClass<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setInputFormatClass(TextInputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的程序通过setup(Context context)来初始化MultipleOutputs对象，并在mapper函数中调用MultipleOutputs的write方法将数据输出到根据value的值不同的文件夹中（通过调用generateFileName函数来处理）。MultipleOutputs类有多个不同版本的write方法，它们的函数原型如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;K, V&gt; <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(String namedOutput, K key, V value)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException, InterruptedException</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> &lt;K, V&gt; <span class="keyword">void</span> <span class="title">write</span><span class="params">(String namedOutput, K key, V value,</span></span></span><br><span class="line"><span class="function"><span class="params">      String baseOutputPath)</span> <span class="keyword">throws</span> IOException, InterruptedException </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(KEYOUT key, VALUEOUT value, String baseOutputPath)</span> </span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException, InterruptedException</span></span><br></pre></td></tr></table></figure>

<p>我们可以根据不同的需求调用不同的write方法。<br>好了，大家来看看上面程序运行的结果吧：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">/home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop jar                        \</span><br><span class="line">      /export1/tmp/wyp/OutputText.jar com.wyp.MulOutput    \</span><br><span class="line">      /home/wyp/apat63_99.txt                              \ </span><br><span class="line">      /home/wyp/out11</span><br></pre></td></tr></table></figure>

<p>测试数据还是上面给的地址。看下/home/wyp/out11文件中有什么吧：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[wyp<span class="meta">@l</span>-datalogm1.data.cn1 bin]$ /home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop fs \</span><br><span class="line">                                            -ls /home/wyp/out11</span><br><span class="line">.............................这里省略了很多...................................</span><br><span class="line">drwxr-xr-x - wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/VN</span><br><span class="line">drwxr-xr-x - wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">41</span> /home/wyp/out11/VU</span><br><span class="line">drwxr-xr-x - wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/YE</span><br><span class="line">drwxr-xr-x - wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/YU</span><br><span class="line">drwxr-xr-x - wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/ZA</span><br><span class="line">.............................这里省略了很多...................................</span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/_SUCCESS</span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/part-m-<span class="number">00000</span></span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp  supergroup  <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">42</span> /home/wyp/out11/part-m-<span class="number">00001</span></span><br></pre></td></tr></table></figure>

<p>　　现在输出的结果和用旧版本的MultipleOutputFormat输出的结果很类似了；但是在输出的结果中还有两个以part开头的文件夹，而且里面什么都没有，这是怎么回事？和第二个测试程序一样，这也是程序默认的输出文件名。那么我们可以在程序输出的结果中不输出两个文件夹吗？当然可以了，呵呵。如何实现呢？其实很简单，在上面的代码的main函数中加入以下一行代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LazyOutputFormat.setOutputFormatClass(job,</span><br><span class="line">                TextOutputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>如果加入了上面的一行代码，请同时注释掉你代码中下面一行代码（如果有）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">job.setOutputFormatClass(TextOutputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>再去看下输出结果吧：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[wyp<span class="meta">@l</span>-datalogm1.data.cn1 bin]$ /home/q/hadoop-<span class="number">2.2</span><span class="number">.0</span>/bin/hadoop fs \</span><br><span class="line">                                                  -ls /home/wyp/out12</span><br><span class="line">.............................这里省略了很多...................................</span><br><span class="line">drwxr-xr-x - wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/VU</span><br><span class="line">drwxr-xr-x - wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/YE</span><br><span class="line">drwxr-xr-x - wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/YU</span><br><span class="line">drwxr-xr-x - wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/ZA</span><br><span class="line">drwxr-xr-x - wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/ZM</span><br><span class="line">drwxr-xr-x - wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/ZW</span><br><span class="line">.............................这里省略了很多...................................</span><br><span class="line">-rw-r--r-- <span class="number">3</span> wyp supergroup    <span class="number">0</span> <span class="number">2013</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">44</span> /home/wyp/out12/_SUCCESS</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">Tunan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yerias.github.io/2020/11/25/hadoop/15/">http://yerias.github.io/2020/11/25/hadoop/15/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hadoop/">Hadoop</a></div><div class="social-share" data-disabled="facebook,twitter,douban,linkedin,diandian"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/11/26/phoenix/1/"><i class="fa fa-chevron-left">  </i><span>Phoenix配置&amp;二级索引&amp;优化</span></a></div><div class="next-post pull-right"><a href="/2020/11/21/clickhouse/2/"><span>ClickHouse多节点的安装以及分布式表和本地表的创建</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/soroush-golpoor-1497416-unsplash.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By Tunan</div><div class="framework-info"><span>Driven - </span><a href="#"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="#"><span>Melody</span></a></div><div class="footer_custom_text">大家好，我是图南，很高兴认识你们！</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>